{"links": {"self": {"href": "data/repositories/osrf/gazebo_models/pullrequests/268/comments/46973093.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebo_models/diff/jenniferdavid/gazebo_models:8192ce2b873f..5a5b41e9f5b1?path=container40%2Fmodel2.sdf"}, "html": {"href": "#!/osrf/gazebo_models/pull-requests/268/_/diff#comment-46973093"}}, "parent": {"id": 46932307, "links": {"self": {"href": "data/repositories/osrf/gazebo_models/pullrequests/268/comments/46932307.json"}, "html": {"href": "#!/osrf/gazebo_models/pull-requests/268/_/diff#comment-46932307"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 268, "links": {"self": {"href": "data/repositories/osrf/gazebo_models/pullrequests/268.json"}, "html": {"href": "#!/osrf/gazebo_models/pull-requests/268"}}, "title": "Gazebo models of harbour entities - 20 and 40 feet containers"}, "content": {"raw": "I ran into the same problem. It could be gazebo's fault. \n\nThe following patch fixes the crash for me on gazebo7: \n\n~~~\ndiff -r 374363e4067f gazebo/rendering/RayQuery.cc\n--- a/gazebo/rendering/RayQuery.cc\tThu Aug 31 17:48:24 2017 -0700\n+++ b/gazebo/rendering/RayQuery.cc\tWed Oct 11 15:52:53 2017 -0700\n@@ -73,10 +73,14 @@\n     for (unsigned int j = 0; j < mesh->GetSubMeshCount(); ++j)\n     {\n       const common::SubMesh *submesh = mesh->GetSubMesh(j);\n-      for (unsigned int k = 0; k < submesh->GetIndexCount(); k += 3)\n+      if (submesh->GetVertexCount() < 3u || submesh->GetIndexCount() < 3u)\n+        continue;\n+\n+      unsigned int indexCount = submesh->GetIndexCount();\n+      for (unsigned int k = 0; k < indexCount; k += 3)\n       {\n-        if (submesh->GetVertexCount() < 3u)\n-          continue;\n+        if (indexCount <= k+2)\n+          break;\n \n         ignition::math::Vector3d vertexA =\n           submesh->Vertex(submesh->GetIndex(k));\n~~~\n\nIt's still weird that one submesh only has a number of indices that's not a multiple of 3 (i.e. triangle) but still gazebo shouldn't just crash.", "markup": "markdown", "html": "<p>I ran into the same problem. It could be gazebo's fault. </p>\n<p>The following patch fixes the crash for me on gazebo7: </p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 374363e4067f gazebo/rendering/RayQuery.cc</span>\n<span class=\"gd\">--- a/gazebo/rendering/RayQuery.cc  Thu Aug 31 17:48:24 2017 -0700</span>\n<span class=\"gi\">+++ b/gazebo/rendering/RayQuery.cc  Wed Oct 11 15:52:53 2017 -0700</span>\n<span class=\"gu\">@@ -73,10 +73,14 @@</span>\n     for (unsigned int j = 0; j &lt; mesh-&gt;GetSubMeshCount(); ++j)\n     {\n       const common::SubMesh *submesh = mesh-&gt;GetSubMesh(j);\n<span class=\"gd\">-      for (unsigned int k = 0; k &lt; submesh-&gt;GetIndexCount(); k += 3)</span>\n<span class=\"gi\">+      if (submesh-&gt;GetVertexCount() &lt; 3u || submesh-&gt;GetIndexCount() &lt; 3u)</span>\n<span class=\"gi\">+        continue;</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+      unsigned int indexCount = submesh-&gt;GetIndexCount();</span>\n<span class=\"gi\">+      for (unsigned int k = 0; k &lt; indexCount; k += 3)</span>\n       {\n<span class=\"gd\">-        if (submesh-&gt;GetVertexCount() &lt; 3u)</span>\n<span class=\"gd\">-          continue;</span>\n<span class=\"gi\">+        if (indexCount &lt;= k+2)</span>\n<span class=\"gi\">+          break;</span>\n\n         ignition::math::Vector3d vertexA =\n           submesh-&gt;Vertex(submesh-&gt;GetIndex(k));\n</pre></div>\n\n\n<p>It's still weird that one submesh only has a number of indices that's not a multiple of 3 (i.e. triangle) but still gazebo shouldn't just crash.</p>", "type": "rendered"}, "created_on": "2017-10-11T22:57:19.167925+00:00", "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "inline": {"to": null, "from": null, "outdated": true, "path": "container40/model2.sdf"}, "updated_on": "2017-10-11T22:57:19.170815+00:00", "type": "pullrequest_comment", "id": 46973093}